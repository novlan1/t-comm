<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>loader/loader.ts - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/novlan1/t-comm" target="_blank" class="menu-item" id="repository" >Github repo</a></h2><h3>Modules</h3><ul><li><a href="module-base_function.html">base/function</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-base_function.html#.parseFunction">parseFunction</a></li></ul></li><li><a href="module-base_list.html">base/list</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-base_list.html#.flatten">flatten</a></li><li data-type='method' style='display: none;'><a href="module-base_list.html#.shuffle">shuffle</a></li></ul></li><li><a href="module-base_number.html">base/number</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-base_number.html#.getUnitPreviousRatio">getUnitPreviousRatio</a></li></ul></li><li><a href="module-base_object.html">base/object</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-base_object.html#.toHumpObj">toHumpObj</a></li></ul></li><li><a href="module-base_string.html">base/string</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-base_string.html#.toUnicodeAt">toUnicodeAt</a></li><li data-type='method' style='display: none;'><a href="module-base_string.html#.toUnicode">toUnicode</a></li></ul></li><li><a href="module-canvas_multi-img.html">canvas/multi-img</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-canvas_multi-img.html#.mergeMultiCanvasPic">mergeMultiCanvasPic</a></li></ul></li><li><a href="module-canvas_table.html">canvas/table</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-canvas_table.html#.createCanvasTable">createCanvasTable</a></li></ul></li><li><a href="module-date_date.html">date/date</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-date_date.html#.getMonthDay">getMonthDay</a></li><li data-type='method' style='display: none;'><a href="module-date_date.html#.getMonthDay2">getMonthDay2</a></li><li data-type='method' style='display: none;'><a href="module-date_date.html#.isSameWeek">isSameWeek</a></li></ul></li><li><a href="module-date_time.html">date/time</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-date_time.html#.timeStampFormat">timeStampFormat</a></li><li data-type='method' style='display: none;'><a href="module-date_time.html#.dateFormat">dateFormat</a></li><li data-type='method' style='display: none;'><a href="module-date_time.html#.parseTime">parseTime</a></li><li data-type='method' style='display: none;'><a href="module-date_time.html#.getTimeAgo">getTimeAgo</a></li><li data-type='method' style='display: none;'><a href="module-date_time.html#.getTimeAgoOrDate">getTimeAgoOrDate</a></li><li data-type='method' style='display: none;'><a href="module-date_time.html#.getCountDownObj">getCountDownObj</a></li></ul></li><li><a href="module-toc.html">toc</a></li><li><a href="module-url.html">url</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-url.html#.getQueryObj">getQueryObj</a></li><li data-type='method' style='display: none;'><a href="module-url.html#.composeUrlQuery">composeUrlQuery</a></li></ul></li><li><a href="module-util.html">util</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-util.html#.isRegExp">isRegExp</a></li><li data-type='method' style='display: none;'><a href="module-util.html#.isDate">isDate</a></li><li data-type='method' style='display: none;'><a href="module-util.html#.isFunction">isFunction</a></li><li data-type='method' style='display: none;'><a href="module-util.html#.cached">cached</a></li><li data-type='method' style='display: none;'><a href="module-util.html#.camelize">camelize</a></li><li data-type='method' style='display: none;'><a href="module-util.html#.hyphenate">hyphenate</a></li><li data-type='method' style='display: none;'><a href="module-util.html#.capitalize">capitalize</a></li><li data-type='method' style='display: none;'><a href="module-util.html#.titleize">titleize</a></li><li data-type='method' style='display: none;'><a href="module-util.html#.extend">extend</a></li><li data-type='method' style='display: none;'><a href="module-util.html#.getThousandSeparator">getThousandSeparator</a></li><li data-type='method' style='display: none;'><a href="module-util.html#.getThousandSeparator2">getThousandSeparator2</a></li></ul></li><li><a href="module-validate.html">validate</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-validate.html#.isExternal">isExternal</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.validURL">validURL</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.validLowerCase">validLowerCase</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.validUpperCase">validUpperCase</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.validAlphabets">validAlphabets</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.validEmail">validEmail</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.isString">isString</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.isArray">isArray</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.isQQNumber">isQQNumber</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.isEmail">isEmail</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.isMobile">isMobile</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.isTel">isTel</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#.isIdCard">isIdCard</a></li></ul></li><li><a href="module-gen-version-tip.html">gen-version-tip</a></li><li><a href="module-gen-version.html">gen-version</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-gen-version.html#.genVersion">genVersion</a></li></ul></li><li><a href="module-wecom-robot_base.html">wecom-robot/base</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-wecom-robot_base.html#.sendWxRobotMsg">sendWxRobotMsg</a></li><li data-type='method' style='display: none;'><a href="module-wecom-robot_base.html#.sendWxRobotMarkdown">sendWxRobotMarkdown</a></li><li data-type='method' style='display: none;'><a href="module-wecom-robot_base.html#.sendWxRobotImg">sendWxRobotImg</a></li></ul></li><li><a href="module-wecom-robot_helper.html">wecom-robot/helper</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-wecom-robot_helper.html#.sendToRobot">sendToRobot</a></li></ul></li><li><a href="module-wecom-robot_send-img.html">wecom-robot/send-img</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-wecom-robot_send-img.html#.sendWxRobotBase64Img">sendWxRobotBase64Img</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#base/function">base/function</a></li><li><a href="global.html#base/list">base/list</a></li><li><a href="global.html#isListAllEqual">isListAllEqual</a></li><li><a href="global.html#getKeyValuesMap">getKeyValuesMap</a></li><li><a href="global.html#markMaxAndMinOfObj">markMaxAndMinOfObj</a></li><li><a href="global.html#getPreviousRatio">getPreviousRatio</a></li><li><a href="global.html#getMaxAndMinIdx">getMaxAndMinIdx</a></li><li><a href="global.html#flattenPreData">flattenPreData</a></li><li><a href="global.html#base/number">base/number</a></li><li><a href="global.html#base/object">base/object</a></li><li><a href="global.html#base/string">base/string</a></li><li><a href="global.html#getAccCellWidth">getAccCellWidth</a></li><li><a href="global.html#getAreaData">getAreaData</a></li><li><a href="global.html#getAllAreaData">getAllAreaData</a></li><li><a href="global.html#getAreaCode">getAreaCode</a></li><li><a href="global.html#getProvName">getProvName</a></li><li><a href="global.html#getCityName">getCityName</a></li><li><a href="global.html#getAreaName">getAreaName</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html#setCookie">setCookie</a></li><li><a href="global.html#clearCookie">clearCookie</a></li><li><a href="global.html#clearAll">clearAll</a></li><li><a href="global.html#uploadCOSFile">uploadCOSFile</a></li><li><a href="global.html#removeCss">removeCss</a></li><li><a href="global.html#date/date">date/date</a></li><li><a href="global.html#date/time">date/time</a></li><li><a href="global.html#getRealUA">getRealUA</a></li><li><a href="global.html#checkUAIsIOS">checkUAIsIOS</a></li><li><a href="global.html#getEnvUAType">getEnvUAType</a></li><li><a href="global.html#loadJS">loadJS</a></li><li><a href="global.html#loadCSS">loadCSS</a></li><li><a href="global.html#saveBase64ImgToFile">saveBase64ImgToFile</a></li><li><a href="global.html#turnLocalImg2Base64">turnLocalImg2Base64</a></li><li><a href="global.html#saveRemoteImgToLocal">saveRemoteImgToLocal</a></li><li><a href="global.html#getImgMd5">getImgMd5</a></li><li><a href="global.html#startPipeline">startPipeline</a></li><li><a href="global.html#baseRequestRainbow">baseRequestRainbow</a></li><li><a href="global.html#randomNum">randomNum</a></li><li><a href="global.html#signatureGenerator">signatureGenerator</a></li><li><a href="global.html#genRainbowHeaderSignature">genRainbowHeaderSignature</a></li><li><a href="global.html#addOrUpdateRainbowKV">addOrUpdateRainbowKV</a></li><li><a href="global.html#addRainbowKV">addRainbowKV</a></li><li><a href="global.html#updateRainbowKV">updateRainbowKV</a></li><li><a href="global.html#createRainbowPublishJob">createRainbowPublishJob</a></li><li><a href="global.html#publishRainbowTask">publishRainbowTask</a></li><li><a href="global.html#closeRainbowTask">closeRainbowTask</a></li><li><a href="global.html#updateRainbowKVAndPublish">updateRainbowKVAndPublish</a></li><li><a href="global.html#fetchRainbowConfig">fetchRainbowConfig</a></li><li><a href="global.html#getBranchLifeCycle">getBranchLifeCycle</a></li><li><a href="global.html#getProjectDefaultBranch">getProjectDefaultBranch</a></li><li><a href="global.html#getBranchesByProjectName">getBranchesByProjectName</a></li><li><a href="global.html#getOneBranchDetail">getOneBranchDetail</a></li><li><a href="global.html#getOneCommitDetail">getOneCommitDetail</a></li><li><a href="global.html#createMR">createMR</a></li><li><a href="global.html#getMrList">getMrList</a></li><li><a href="global.html#getOneMrComments">getOneMrComments</a></li><li><a href="global.html#getOneProjectDetail">getOneProjectDetail</a></li><li><a href="global.html#getOneProjectBySearch">getOneProjectBySearch</a></li><li><a href="global.html#getAllProjects">getAllProjects</a></li><li><a href="global.html#toc">toc</a></li><li><a href="global.html#url">url</a></li><li><a href="global.html#util">util</a></li><li><a href="global.html#validate">validate</a></li><li><a href="global.html#gen-version-tip">gen-version-tip</a></li><li><a href="global.html#gen-version">gen-version</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">loader/loader.ts</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const exportObj = {
  JSMAP: {},
}

/**
 * 动态加载JS
 * @param url - JS链接
 * @param options - defer/async/crossorigin选项
 * @returns Promise
 * @example
 *
 * loadJS('xx.js').then(() => {})
 */
export function loadJS(url, options) {
  return new Promise((resolve, reject) => {
    if (typeof exportObj.JSMAP[url] === 'undefined') {
      exportObj.JSMAP[url] = 0

      const c: any = document.createElement('script')
      if (options &amp;&amp; options.defer) c.setAttribute('defer', 'defer')
      if (options &amp;&amp; options.async) c.setAttribute('async', 'async')
      if (options &amp;&amp; options.crossorigin)
        c.setAttribute('crossorigin', 'crossorigin')

      const e = document.body || document.getElementsByTagName('head')[0]
      c.onerror = function () {
        reject()
      }
      if (c.readyState) {
        c.onreadystatechange = function () {
          if (c.readyState === 'loaded' || c.readyState === 'complete') {
            c.onreadystatechange = null
            exportObj.JSMAP[url] += 1
            resolve(1)
          }
        }
      } else {
        c.onload = function () {
          exportObj.JSMAP[url] += 1
          resolve(1)
        }
      }
      c.src = url
      e.appendChild(c)
    } else {
      const tc = setInterval(() => {
        if (exportObj.JSMAP[url]) {
          clearInterval(tc)
          resolve(1)
        }
      }, 20)
    }
  })
}

/**
 * 动态加载CSS
 * @param url CSS链接
 * @example
 *
 * loadCSS('xxx.css')
 */
export function loadCSS(url) {
  let addSign = true
  const links = document.getElementsByTagName('link')
  for (let i = 0; i &lt; links.length; i++) {
    if (links[i] &amp;&amp; links[i].href &amp;&amp; links[i].href.indexOf(url) !== -1) {
      addSign = false
    }
  }
  if (addSign) {
    const link = document.createElement('link')
    link.type = 'text/css'
    link.rel = 'stylesheet'
    link.href = url
    document.getElementsByTagName('head')[0].appendChild(link)
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on Mon Sep 26 2022 02:14:28 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
