<!DOCTYPE html><html lang="en"><head>
    
    <meta charset="utf-8">
    <title>morse-pwd/morse-pwd.ts - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer=""></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger">
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    
    <input type="text" id="nav-search" placeholder="Search">
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/novlan1/t-comm" target="_blank" class="menu-item" id="repository">Github repo</a></h2><h3>Classes</h3><ul><li><a href="JsDocHandler.html">JsDocHandler</a><ul class="methods"><li data-type="method" style="display: none;"><a href="JsDocHandler.html#.init">init</a></li></ul></li><li><a href="MorsePwd.html">MorsePwd</a><ul class="methods"><li data-type="method" style="display: none;"><a href="MorsePwd.html#.init">init</a></li><li data-type="method" style="display: none;"><a href="MorsePwd.html#clear">clear</a></li></ul></li><li><a href="MpCI_MpCI.html">MpCI#MpCI</a></li></ul><h3>Global</h3><ul><li class="nav-separator">-------   base/function   -------</li><li><a href="global.html#parseFunction">parseFunction</a></li><li><a href="global.html#cached">cached</a></li><li class="nav-separator">---------   base/list   ---------</li><li><a href="global.html#flatten">flatten</a></li><li><a href="global.html#shuffle">shuffle</a></li><li><a href="global.html#getAccCellWidth">getAccCellWidth</a></li><li><a href="global.html#isListAllEqual">isListAllEqual</a></li><li><a href="global.html#getKeyValuesMap">getKeyValuesMap</a></li><li><a href="global.html#getPreviousRatio">getPreviousRatio</a></li><li><a href="global.html#getMaxAndMinIdx">getMaxAndMinIdx</a></li><li><a href="global.html#flattenPreData">flattenPreData</a></li><li><a href="global.html#compareTwoList">compareTwoList</a></li><li class="nav-separator">--------   base/number   --------</li><li><a href="global.html#getUnitPreviousRatio">getUnitPreviousRatio</a></li><li><a href="global.html#getPartRatio">getPartRatio</a></li><li><a href="global.html#NUMBER_CHI_MAP">NUMBER_CHI_MAP</a></li><li><a href="global.html#getThousandSeparator">getThousandSeparator</a></li><li><a href="global.html#getThousandSeparator2">getThousandSeparator2</a></li><li class="nav-separator">--------   base/object   --------</li><li><a href="global.html#toHumpObj">toHumpObj</a></li><li><a href="global.html#extend">extend</a></li><li class="nav-separator">--------   base/string   --------</li><li><a href="global.html#camelize">camelize</a></li><li><a href="global.html#hyphenate">hyphenate</a></li><li><a href="global.html#capitalize">capitalize</a></li><li><a href="global.html#titleize">titleize</a></li><li><a href="global.html#lowerInitial">lowerInitial</a></li><li><a href="global.html#toUnicodeAt">toUnicodeAt</a></li><li><a href="global.html#toUnicode">toUnicode</a></li><li class="nav-separator">-----------   canvas   -----------</li><li><a href="global.html#addTextForImg">addTextForImg</a></li><li><a href="global.html#mergeMultiCanvasPic">mergeMultiCanvasPic</a></li><li><a href="global.html#createCanvasTable">createCanvasTable</a></li><li class="nav-separator">------------   city   ------------</li><li><a href="global.html#getAreaData">getAreaData</a></li><li><a href="global.html#getAllAreaData">getAllAreaData</a></li><li><a href="global.html#getAreaCode">getAreaCode</a></li><li><a href="global.html#getProvName">getProvName</a></li><li><a href="global.html#getCityName">getCityName</a></li><li><a href="global.html#getAreaName">getAreaName</a></li><li class="nav-separator">-----------   cookie   -----------</li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html#setCookie">setCookie</a></li><li><a href="global.html#clearCookie">clearCookie</a></li><li><a href="global.html#clearAll">clearAll</a></li><li class="nav-separator">------------   cos   ------------</li><li><a href="global.html#uploadCOSFile">uploadCOSFile</a></li><li class="nav-separator">------------   css   ------------</li><li><a href="global.html#removeCss">removeCss</a></li><li class="nav-separator">------------   date   ------------</li><li><a href="global.html#getMonthDay">getMonthDay</a></li><li><a href="global.html#getMonthDay2">getMonthDay2</a></li><li><a href="global.html#isSameWeek">isSameWeek</a></li><li><a href="global.html#timeStampFormat">timeStampFormat</a></li><li><a href="global.html#dateFormat">dateFormat</a></li><li><a href="global.html#parseTime">parseTime</a></li><li><a href="global.html#getTimeAgo">getTimeAgo</a></li><li><a href="global.html#getTimeAgoOrDate">getTimeAgoOrDate</a></li><li><a href="global.html#getCountDownObj">getCountDownObj</a></li><li><a href="global.html#getDayStartTimestamp">getDayStartTimestamp</a></li><li><a href="global.html#getDayEndTimeStamp">getDayEndTimeStamp</a></li><li class="nav-separator">------------   env   ------------</li><li><a href="global.html#checkUAIsIOS">checkUAIsIOS</a></li><li><a href="global.html#getEnvUAType">getEnvUAType</a></li><li class="nav-separator">------------   git   ------------</li><li><a href="global.html#getGitCurBranch">getGitCurBranch</a></li><li><a href="global.html#getGitCommitInfo">getGitCommitInfo</a></li><li><a href="global.html#getGitLastTag">getGitLastTag</a></li><li><a href="global.html#getGitCommitsBeforeTag">getGitCommitsBeforeTag</a></li><li><a href="global.html#getGitAuthor">getGitAuthor</a></li><li class="nav-separator">-----------   loader   -----------</li><li><a href="global.html#loadJS">loadJS</a></li><li><a href="global.html#loadCSS">loadCSS</a></li><li class="nav-separator">-----------   mp-ci   -----------</li><li><a href="global.html#parseUploadResult">parseUploadResult</a></li><li class="nav-separator">----------   node-img   ----------</li><li><a href="global.html#saveBase64ImgToFile">saveBase64ImgToFile</a></li><li><a href="global.html#turnLocalImg2Base64">turnLocalImg2Base64</a></li><li><a href="global.html#saveRemoteImgToLocal">saveRemoteImgToLocal</a></li><li><a href="global.html#getImgMd5">getImgMd5</a></li><li class="nav-separator">-----   open-source-report   -----</li><li><a href="global.html#sendOpenSourceReport">sendOpenSourceReport</a></li><li class="nav-separator">----------   pipeline   ----------</li><li><a href="global.html#startPipeline">startPipeline</a></li><li class="nav-separator">----------   rainbow   ----------</li><li><a href="global.html#addOrUpdateRainbowKV">addOrUpdateRainbowKV</a></li><li><a href="global.html#addRainbowKV">addRainbowKV</a></li><li><a href="global.html#updateRainbowKV">updateRainbowKV</a></li><li><a href="global.html#createRainbowPublishJob">createRainbowPublishJob</a></li><li><a href="global.html#publishRainbowTask">publishRainbowTask</a></li><li><a href="global.html#closeRainbowTask">closeRainbowTask</a></li><li><a href="global.html#updateRainbowKVAndPublish">updateRainbowKVAndPublish</a></li><li><a href="global.html#queryGroupInfo">queryGroupInfo</a></li><li><a href="global.html#fetchRainbowConfig">fetchRainbowConfig</a></li><li class="nav-separator">-------   rainbow-to-cos   -------</li><li><a href="global.html#watchRainbowToCosAndSendRobot">watchRainbowToCosAndSendRobot</a></li><li class="nav-separator">----------   tam/img   ----------</li><li><a href="global.html#genCustomEventImgAndSendRobot">genCustomEventImgAndSendRobot</a></li><li><a href="global.html#genMultiImgAndSendRobot">genMultiImgAndSendRobot</a></li><li><a href="global.html#parseResult">parseResult</a></li><li><a href="global.html#genSummaryDataAndSendRobot">genSummaryDataAndSendRobot</a></li><li class="nav-separator">------------   tgit   ------------</li><li><a href="global.html#getBranchLifeCycle">getBranchLifeCycle</a></li><li><a href="global.html#getProjectDefaultBranch">getProjectDefaultBranch</a></li><li><a href="global.html#getBranchesByProjectName">getBranchesByProjectName</a></li><li><a href="global.html#getOneBranchDetail">getOneBranchDetail</a></li><li><a href="global.html#getOneCommitDetail">getOneCommitDetail</a></li><li><a href="global.html#createMR">createMR</a></li><li><a href="global.html#getMrList">getMrList</a></li><li><a href="global.html#getOneMrComments">getOneMrComments</a></li><li><a href="global.html#getOneProjectDetail">getOneProjectDetail</a></li><li><a href="global.html#getOneProjectBySearch">getOneProjectBySearch</a></li><li><a href="global.html#getAllProjects">getAllProjects</a></li><li><a href="global.html#deleteTGitProject">deleteTGitProject</a></li><li class="nav-separator">------------   url   ------------</li><li><a href="global.html#getQueryObj">getQueryObj</a></li><li><a href="global.html#composeUrlQuery">composeUrlQuery</a></li><li><a href="global.html#encodeUrlParam">encodeUrlParam</a></li><li><a href="global.html#decodeUrlParam">decodeUrlParam</a></li><li class="nav-separator">------------   util   ------------</li><li><a href="global.html#buildAndUpload">buildAndUpload</a></li><li><a href="global.html#getEntryFiles">getEntryFiles</a></li><li><a href="global.html#readEnvVariable">readEnvVariable</a></li><li><a href="global.html#formatBite">formatBite</a></li><li><a href="global.html#innerCopyDir">innerCopyDir</a></li><li><a href="global.html#copyDir">copyDir</a></li><li><a href="global.html#deleteFolder">deleteFolder</a></li><li><a href="global.html#copyFile">copyFile</a></li><li><a href="global.html#traverseFolder">traverseFolder</a></li><li><a href="global.html#execCommand">execCommand</a></li><li><a href="global.html#writeEnvTokenToNpmRC">writeEnvTokenToNpmRC</a></li><li><a href="global.html#statisticsPages">statisticsPages</a></li><li><a href="global.html#statisticsComponent">statisticsComponent</a></li><li><a href="global.html#sleep">sleep</a></li><li class="nav-separator">----------   validate   ----------</li><li><a href="global.html#isIdCard">isIdCard</a></li><li><a href="global.html#isRegExp">isRegExp</a></li><li><a href="global.html#isDate">isDate</a></li><li><a href="global.html#isFunction">isFunction</a></li><li><a href="global.html#isExternal">isExternal</a></li><li><a href="global.html#validURL">validURL</a></li><li><a href="global.html#validLowerCase">validLowerCase</a></li><li><a href="global.html#validUpperCase">validUpperCase</a></li><li><a href="global.html#validAlphabets">validAlphabets</a></li><li><a href="global.html#validEmail">validEmail</a></li><li><a href="global.html#isString">isString</a></li><li><a href="global.html#isArray">isArray</a></li><li><a href="global.html#isQQNumber">isQQNumber</a></li><li><a href="global.html#isEmail">isEmail</a></li><li><a href="global.html#isMobile">isMobile</a></li><li><a href="global.html#isTel">isTel</a></li><li class="nav-separator">--------   version-tip   --------</li><li><a href="global.html#genVersionAndSendChangeLog">genVersionAndSendChangeLog</a></li><li><a href="global.html#genVersionTip">genVersionTip</a></li><li><a href="global.html#genVersion">genVersion</a></li><li class="nav-separator">----------   weather   ----------</li><li><a href="global.html#fetchWeatherData">fetchWeatherData</a></li><li><a href="global.html#sendWeatherRobotMsg">sendWeatherRobotMsg</a></li><li><a href="global.html#getWeatherRobotContent">getWeatherRobotContent</a></li><li class="nav-separator">--------   wecom-robot   --------</li><li><a href="global.html#sendWxRobotMsg">sendWxRobotMsg</a></li><li><a href="global.html#sendWxRobotMarkdown">sendWxRobotMarkdown</a></li><li><a href="global.html#sendWxRobotImg">sendWxRobotImg</a></li><li><a href="global.html#batchSendWxRobotBase64Img">batchSendWxRobotBase64Img</a></li><li><a href="global.html#sendWxRobotBase64Img">sendWxRobotBase64Img</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">morse-pwd/morse-pwd.ts</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>class MorsePwd {
  /**
   * 初始化
   * @static
   * @param {Object} options 选项
   * @param {Array&lt;number&gt;} options.pwd 密码
   * @param {Function} options.cb 成功回调
   * @param {Boolean} options.quiet 是否安静模式（不打印日志）
   * @param {number} options.holdTime 等待多久后就恢复原位
   * @param {'H5' | 'h5' | 'mp' | 'MP'} options.envType 环境类型
   * @param {String} options.selector h5模式下的选择器
   *
   * @example &lt;caption&gt;小程序环境&lt;/caption&gt;
   * &lt;template&gt;
   *   &lt;div
   *     class="tip-match-header"
   *     /@longpress="onLongPressWrap"
   *     /@click.stop="onClickWrap"
   *   &gt;
   * &lt;/template&gt;
   *
   * &lt;script&gt;
   * export default {
   *   data() {
   *     return {
   *       morsePwd: null,
   *     };
   *   },
   *   mounted() {
   *     this.morsePwd = MorsePwd.init({
   *       pwd: [1, 1, 1, 2, 2, 2, 1, 1, 1],
   *       cb: () =&gt; {
   *         this.showToast('hhh');
   *       },
   *       envType: 'MP',
   *     });
   *   },
   *   beforeDestroy() {
   *     this.morsePwd.clear();
   *   },
   *   methods: {
   *     onLongPressWrap() {
   *       this.morsePwd.longPress();
   *     },
   *     onClickWrap() {
   *       this.morsePwd.click();
   *     },
   *   }
   * }
   * &lt;/script&gt;
   * @example &lt;caption&gt;H5环境&lt;/caption&gt;
   * &lt;script&gt;
   * export default {
   *   data() {
   *     return {
   *       morsePwd: null,
   *     };
   *   },
   *   mounted() {
   *     this.morsePwd = MorsePwd.init({
   *       pwd: [1, 1, 1, 2, 2, 2, 1, 1, 1],
   *       cb: () =&gt; {
   *         this.showToast('xxx');
   *       },
   *       selector: '#app',
   *       envType: 'H5',
   *     });
   *   },
   *   beforeDestroy() {
   *     this.morsePwd.clear();
   *   },
   * }
   * &lt;/script&gt;
   *
   * @returns {Object} MorsePwd实例
   */
  static init(options) {
    return new MorsePwd(options);
  }

  pwd: Array&lt;number&gt;;
  cb: Function;
  holdTime: number;
  quiet: Boolean;
  selector?: keyof HTMLElementTagNameMap;
  envType?: 'H5' | 'h5' | 'mp' | 'MP';

  clickCode: number;
  longPressCode: number;

  curIdx: number;
  holdTimer: any;
  h5Dom: any;

  longPressTimer: any;
  isLongTouch: Boolean;

  /**
   * 摩斯密码初始化
   * @constructor
   * @param {Object} options 选项
   * @param {Array&lt;number&gt;} options.pwd 密码
   * @param {Function} options.cb 成功回调
   * @param {Boolean} options.quiet 是否安静模式（不打印日志）
   * @param {number} options.holdTime 等待多久后就恢复原位
   * @param {'H5' | 'h5' | 'mp' | 'MP'} options.envType 环境类型
   * @param {String} options.selector h5模式下的选择器
   */
  constructor(options) {
    const DEFAULT_CODE_MAP = {
      CLICK: 1,
      LONG_PRESS: 2,
    };
    const { pwd, cb, quiet = false, holdTime = 5000, envType = '', selector } = options;
    this.pwd = pwd || [];
    this.cb = cb;
    this.holdTime = holdTime;
    this.quiet = quiet;
    this.selector = selector;
    this.envType = envType;

    this.clickCode = DEFAULT_CODE_MAP.CLICK;
    this.longPressCode = DEFAULT_CODE_MAP.LONG_PRESS;

    this.curIdx = 0;
    this.holdTimer = null;
    this.h5Dom = null;

    this.longPressTimer = null;
    this.isLongTouch = false;

    if (this.envType === 'H5') {
      this.bindEvent();
    }
  }

  bindEvent() {
    if (!this.selector) return;
    this.h5Dom = document.querySelector(this.selector);
    if (!this.h5Dom) return;

    this.h5Dom.addEventListener('touchstart', this.onTouchStart.bind(this));
    this.h5Dom.addEventListener('touchend', this.onTouchEnd.bind(this));
    this.h5Dom.addEventListener('touchmove', this.onTouchMove.bind(this));
  }

  onTouchStart() {
    clearTimeout(this.longPressTimer);
    this.longPressTimer = setTimeout(() =&gt; {
      // 处理长按事件
      this.log('longPress');
      this.isLongTouch = true;
      this.longPress();
    }, 350);
  }

  onTouchEnd() {
    clearTimeout(this.longPressTimer);
    if (this.isLongTouch) {
      // 重置标志位
      this.isLongTouch = false;
    } else {
      // 处理点击事件
      this.log('click');
      this.click();
    }
  }

  onTouchMove() {
    clearTimeout(this.longPressTimer);
  }

  /**
   * 清除监听事件
   * @example
   * beforeDestroy() {
   *   this.morsePwd.clear();
   * }
   */
  clear() {
    if (!this.h5Dom) return;
    this.h5Dom.removeEventListener('touchstart', this.onTouchStart.bind(this));
    this.h5Dom.removeEventListener('touchend', this.onTouchEnd.bind(this));
    this.h5Dom.removeEventListener('touchmove', this.onTouchMove.bind(this));
  }

  operation(type) {
    this.log(`type: ${type}, curIdx: ${this.curIdx}, pwd: ${this.pwd}`);

    clearTimeout(this.holdTimer);
    if (this.pwd[this.curIdx] === type) {
      this.curIdx += 1;
      if (this.curIdx === this.pwd.length) {
        this.suc();
      } else {
        clearTimeout(this.holdTimer);
        this.holdTimer = setTimeout(() =&gt; {
          this.reset();
        }, this.holdTime);
      }
    } else {
      this.reset();
    }
  }

  reset() {
    this.curIdx = 0;
  }

  click() {
    this.operation(this.clickCode);
  }

  suc() {
    if (typeof this.cb === 'function') {
      this.cb();
      this.reset();
    }
  }
  longPress() {
    this.operation(this.longPressCode);
  }

  log(...args) {
    if (this.quiet) return;
    console.log(...args);
  }
}

export { MorsePwd };
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>Documentation generated on 2023-04-26 14:10:34 GMT+0000  by novlan1.</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer=""></script>


<script src="scripts/collapse.js" defer=""></script>


    <script src="./jsdoc.js"></script>
    


</body></html>